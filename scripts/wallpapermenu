#!/usr/bin/env bash

WALLPAPER_DIRECTORY=$HOME/Photos/Wallpapers/
CURRENT_WALLPAPER=$WALLPAPER_DIRECTORY/_current_wallpaper

# Selec wallpaper from above directory
# Mark selection with 'm'
WALLPAPERS=$(find ~/Photos/Wallpapers -type f ! -name '_current_wallpaper' -printf '%T@ %p\n' | sort -nr | awk '{ $1=""; sub(/^ /,""); print }')
CHOICE=$(nsxiv -otb $WALLPAPERS)

# Update the timestamp of choice
touch $CHOICE

THEME=${1:-""}

if [[ -z "$THEME" ]]; then
	# Generate colours
	wal -i "$CHOICE" --cols16 -n
else
	wal --theme "$THEME" -i "$CHOICE" --cols16 -n
fi

cp $CHOICE $CURRENT_WALLPAPER

hyprctl hyprpaper wallpaper ,"$CURRENT_WALLPAPER"

# Waybar needs to be refreshed to change colours
killall waybar; waybar

# Set mozilla stuff
pywalfox update
